<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workshop - Automated Tests</title>
    <link rel="stylesheet" href="assets/css/reveal.css">
    <link rel="stylesheet" href="assets/css/black.css">
    <!--<link rel="stylesheet" href="assets/css/night.css">-->
	<link rel="stylesheet" href="assets/css/zenburn.css">
	<link rel="stylesheet" href="assets/css/custom.css">
</head>
<body>
    <div class="reveal">
        <div class="slides">
			<!-- SLIDE 1 -->
            <section data-transition="zoom">
                <h2 class="title"><small class="middle">Workshop:</small> <strong>Automated Tests</strong></h2>
				<p class="first"><small>by Rebel L</small></p>
				<p><small>Contact: dj@rebel-l.net</small></p>
            </section>

			<!-- SLIDE 2 -->
			<section data-transition="zoom">
				<h2 class="title">Types of Automated Tests</h2>
				<p class="fragment">Unit Tests</p>
				<p class="fragment">Component / Integration Tests</p>
				<p class="fragment">System / Functional / Acceptance Tests</p>
				<p class="fragment">Deployment Tests</p>
				<p class="fragment">Layout Tests</p>
				<p class="fragment">Performance Tests</p>
				<p class="fragment">Stress Tests</p>
			</section>

			<!-- SLIDE 3 -->
			<section data-transition="zoom">
				<h2 class="title">Characteristics of Unit Tests</h2>
				<ul>
					<li>tests small units e.g. a method or a class</li>
					<li>abstract all dependencies</li>
					<li>never use database, file system etc.</li>
					<li>runs fast</li>
				</ul>
			</section>

			<!-- SLIDE 4 -->
			<section data-transition="zoom">
				<h2 class="title">Characteristics of <br>Component Tests</h2>
				<ul>
					<li>tests one component</li>
					<li>use dependencies</li>
					<li>use database, file system etc.</li>
					<li class="fragment highlight-current-red">doesn't bootstrap whole application</li>
				</ul>
			</section>

			<!-- SLIDE 5 -->
			<section data-transition="zoom">
				<h2 class="title">Unit vs. Component Tests</h2>
				<p><strong>component tests</strong>:</p>
				<p align="left">use dependent classes ==> can fail on failing dependencies</p>
				<p align="left">need complex setup ==> different bootstrapping</p>
				<p align="left">slower than unit tests</p>
				<p><strong>unit tests</strong>:</p>
				<p align="left">perfect for test driven development</p>
				<p class="fragment highlight-green first">==> <strong>focus on unit tests</strong></p>
			</section>

			<!-- SLIDE 6 -->
			<section>
				<!-- SLIDE 6.1 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Best Practices
					</h2>
					<ul>
						<li>test always positive and negative case</li>
						<li>test default values/behaviour</li>
						<li>test public methods only</li>
						<li>use dependency injection</li>
						<li>avoid classes that are not unittestable</li>
						<li>test abstract classes / traits once</li>
						<li>define which methods you test (see @covers)</li>
						<li>rely on third party libraries/frameworks</li>
						<li>let tests fail on warnings</li>
						<li>JS/PHP: test in strict mode</li>
						<li>PHP: root Exception is forbidden</li>
					</ul>
				</section>

				<!-- SLIDE 6.2 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Test Positive & Negative Cases
					</h2>
					<p>Example #01</p>
					<pre>
						<code class="hljs php">
class Devision
{
	public function calculate($a, $b)
	{
		return $a / $b;
	}
}
						</code>
					</pre>
				</section>

				<!-- Slide 6.3 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Test public methods only
					</h2>
					<p>detects dead code</p>
					<p class="first">Example #02</p>
				</section>

				<!-- Slide 6.4 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Use Dataproviders
					</h2>
					<p>creates a bunch of test cases with same expectation</p>
					<p class="first">Example #03</p>
				</section>

				<!-- Slide 6.5 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Assert exceptions
					</h2>
					<ul>
						<li class="fragment highlight-red">don't use the <strong>@expectedException</strong> annotation</li>
						<li class="fragment highlight-green">assert the Exception where you expect it</li>
					</ul>
					<p class="first">Example #04</p>
				</section>

				<!-- Slide 6.6 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Don't expect root Exception
					</h2>
					<ul>
						<li>unspecific</li>
						<li>strictly not allowed by PHPUnit</li>
						<li>PHPUnit doesn't fail on it anymore, but avoids false positive</li>
						<li>doesn't affect on try catch to catch everything</li>
					</ul>
					<p class="first">Example #05</p>
				</section>

				<!-- Slide 6.7 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Use @covers annotation
					</h2>
					<p>avoids missing test case by accident</p>
					<p class="first">Example #06</p>
				</section>

				<!-- Slide 6.8 -->
				<section>
					<h2 class="title">
						<small class="middle">General</small>:
						Mark dependent tests
					</h2>
					<p>skips dependent test if the dependency fails</p>
					<p class="first">Example #07</p>
				</section>
			</section>

			<!-- SLIDE 7 -->
			<section data-transition="zoom">
				<!-- SLIDE 7.1 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Test default values / behaviour
					</h2>
					<p>avoids failing dependencies</p>
					<p class="first">Example #08</p>
				</section>

				<!-- Slide 7.2 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Avoid not unittestable classes
					</h2>
					<p>forbidden:</p>
					<ul>
						<li>exit()</li>
						<li>die()</li>
					</ul>
					<p>avoid:</p>
					<ul>
						<li>static methods/calls</li>
						<li>global functions</li>
					</ul>
				</section>

				<!-- Slide 7.3 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Use dependency injection
					</h2>
					<p>keeps classes unit testable</p>
					<p class="first">Example #09</p>
				</section>

				<!-- Slide 7.4 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						stub classes vs. mock objects
					</h2>
					<p>Pros Stub Classes:</p>
					<ul>
						<li>easier to implement</li>
					</ul>
					<p>Cons Stub Classes:</p>
					<ul>
						<li>can't assert expectations</li>
						<li>doesn't cover the methods calling dependencies</li>
					</ul>
					<p class="first">Example #10</p>
				</section>

				<!-- Slide 7.5 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Problem Singleton & (static) Factories
					</h2>
					<ul>
						<li>static calls are not mockable</li>
						<li>Singletons are not instanceable with <strong>new</strong> operator</li>
					</ul>
					<p>Solution:</p>
					<ul>
						<li>avoid Singletons</li>
						<li>wrap getInstance() method</li>
						<li>use Factories with object methods only</li>
					</ul>
				</section>

				<!-- Slide 7.6 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						mock method with different inputs/outputs
					</h2>
					<p class="first">Example #11</p>
				</section>

				<!-- Slide 7.7 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Mock Abstract Classes / Interfaces
					</h2>
					<p>getMock() ==> mocks only given methods</p>
					<p>getMockForAbstractClass() ==> mocks all abstract methods</p>
					<p class="first">Example #12</p>
				</section>

				<!-- Slide 7.8 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						Mock Traits
					</h2>
					<p>getMockForTrait() ==> creates object using trait</p>
					<p class="first">Example #13</p>
				</section>

				<!-- Slide 7.9 -->
				<section>
					<h2 class="title">
						<small class="middle">Unit Tests</small>:
						TDD
					</h2>
					<p>Test Driven Development</p>
					<p>write test first</p>
					<p>implement class afterwards</p>
					<p>execute tests ==> should be green</p>
					<p class="first">Example #14</p>
					<!-- TODO -->
				</section>
			</section>

			<!-- Slide 8 -->
			<section data-transition="zoom">
				<h2 class="title">Component Tests</h2>
				<ul>
					<li>Don't repeat whole unit tests</li>
					<li>Don't rely on data of previous tests</li>
					<li>Reset fixtures after every test, better before!</li>
					<li>use @depends to mark test dependencies</li>
					<li>bootstrap database connection</li>
				</ul>
			</section>

			<!-- Slide 9 -->
			<section>
				<h2 class="title">Organizing Tests</h2>
				<pre>
root
  └ tests
    └ Component
      └ report
        └ ... # component test coverage report
      └ bootstrap.php
      └ phpunit.xml
    └ Unit
      └ report
        └ ... # unit test coverage report
      └ bootstrap.php
      └ phpunit.xml
    └ report
      └ ... # over all coverage report
    └ bootstrap.php
    └ phpunit.xml # running Component & Unit test creating one coverage
				</pre>
			</section>

			<!-- Slide 10 -->
			<section data-transition="zoom">
				<h2 class="title">
					Working With Continuous<br>
					Integration / Deployment
				</h2>
				<p>before commit: execute unit tests</p>
				<p>
					every commit triggers continuous integration server:
				</p>
				<ul>
					<li>run unit tests</li>
					<li>run component tests</li>
				</ul>
				<p>
					should be build nightly:
				</p>
				<ul>
					<li>run deployment tests</li>
					<li>run acceptance tests</li>
					<li>run layout tests</li>
				</ul>
				<p class="fragment highlight-blue">
					Rule: on fail fix it immediately
				</p>
			</section>

			<!-- Slide 11 -->
			<section data-transition="zoom">
				<h2 class="title">Layout Tests</h2>
				<p>Have a look at Galen Framework</p>
				<a href="http://galenframework.com/" target="_blank">http://galenframework.com/</a>
			</section>

			<!-- Final Slides -->
			<section data-transition="zoom">
				<h1 class="title">Questions?</h1>
			</section>

			<section data-transition="zoom">
				<h2 class="title">Thank You!</h2>
				<p>Find the presentation and code examples at:</p>
				<a href="https://github.com/rebel-l/workshops/tree/master/AutomatedTests" target="_blank">
					https://github.com/rebel-l/workshops/tree/master/AutomatedTests
				</a>
				<p>Follow me:</p>
				<a href="https://github.com/rebel-l" target="_blank">https://github.com/rebel-l</a>
				<a href="https://www.xing.com/profile/Lars_Gaubisch" target="_blank">https://www.xing.com/profile/Lars_Gaubisch</a>
				<a href="https://de.linkedin.com/in/lars-gaubisch-a6b1a423" target="_blank">https://de.linkedin.com/in/lars-gaubisch-a6b1a423</a>
			</section>
        </div>
    </div>
    <script src="assets/js/head.min.js"></script>
    <script src="assets/js/reveal.js"></script>
    <script>
        Reveal.initialize({
            "backgroundTransition": "slide",
            "slideNumber": true,
            "dependencies": [
                {
                    "src": 'assets/js/highlight.js',
                    "async": false,
                    "callback": function() { hljs.initHighlightingOnLoad(); }
                }
            ]
        });
    </script>
</body>
</html>